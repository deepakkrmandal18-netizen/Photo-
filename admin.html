<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:#05070d;
  color:#fff;
  font-family:Poppins,Arial;
}
.box{
  max-width:420px;
  margin:90px auto;
  background:rgba(255,255,255,.12);
  border-radius:16px;
  padding:20px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
}
button{font-weight:600;cursor:pointer}
.section{
  margin-top:20px;
  padding-top:10px;
  border-top:1px solid rgba(255,255,255,.2);
}
.user{
  background:rgba(0,0,0,.4);
  padding:10px;
  border-radius:10px;
  margin-top:10px;
}
.actions{
  display:flex;
  gap:8px;
  margin-top:8px;
}
.hidden{display:none}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="box" id="loginBox">
  <h2>Admin Login</h2>
  <input id="adminPass" type="password" placeholder="Enter admin password">
  <button onclick="adminLogin()">Login</button>
</div>

<!-- PANEL -->
<div class="box hidden" id="panel">

  <!-- CHANGE PASSWORD -->
  <div class="section">
    <h3>üîê Change Admin Password</h3>
    <input id="newPass" type="password" placeholder="New password">
    <button onclick="changePassword()">Update Password</button>
  </div>

  <!-- UPLOAD -->
  <div class="section">
    <h3>üì§ Upload Photo</h3>
    <input type="file" id="photo">
    <button onclick="uploadPhoto()">Upload</button>
  </div>

  <!-- USERS -->
  <div class="section">
    <h3>üë• Users</h3>
    <div id="users"></div>
  </div>

</div>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import {
  getFirestore, collection, onSnapshot,
  updateDoc, doc, addDoc
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCOJiED03-ExQN0YdHR26WGC9Eq67PxQ",
  authDomain: "photos-90be5.firebaseapp.com",
  projectId: "photos-90be5"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= SIMPLE ADMIN PASSWORD ================= */
/* First time default password */
let ADMIN_PASSWORD = localStorage.getItem("ADMIN_PASS") || "admin123";

/* LOGIN */
window.adminLogin = ()=>{
  if(adminPass.value !== ADMIN_PASSWORD){
    alert("Wrong admin password");
    return;
  }
  loginBox.classList.add("hidden");
  panel.classList.remove("hidden");
  loadUsers();
};

/* CHANGE PASSWORD */
window.changePassword = ()=>{
  if(newPass.value.length < 4){
    alert("Password too short");
    return;
  }
  ADMIN_PASSWORD = newPass.value;
  localStorage.setItem("ADMIN_PASS", ADMIN_PASSWORD);
  newPass.value = "";
  alert("‚úÖ Admin password changed");
};

/* USERS */
function loadUsers(){
  onSnapshot(collection(db,"users"), snap=>{
    users.innerHTML="";
    snap.forEach(d=>{
      const u=d.data();
      users.innerHTML+=`
        <div class="user">
          <b>${u.username}</b><br>
          Status: ${u.status}
          <div class="actions">
            <button onclick="approve('${d.id}')">Approve</button>
            <button onclick="decline('${d.id}')">Decline</button>
          </div>
        </div>`;
    });
  });
}
window.approve = uid => updateDoc(doc(db,"users",uid),{status:"approved"});
window.decline = uid => updateDoc(doc(db,"users",uid),{status:"declined"});

/* ================= IMGBB UPLOAD ================= */
const IMGBB_KEY = "b09c0e1b8cabedcffe103559abfb7033";

window.uploadPhoto = async ()=>{
  const file = photo.files[0];
  if(!file){ alert("Select photo"); return; }

  const form = new FormData();
  form.append("image", file);

  const res = await fetch(
    `https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,
    { method:"POST", body:form }
  );
  const data = await res.json();
  if(!data.success){ alert("Upload failed"); return; }

  await addDoc(collection(db,"photos"),{
    url:data.data.url,
    time:Date.now()
  });
  alert("Photo uploaded");
};
</script>

</body>
</html>